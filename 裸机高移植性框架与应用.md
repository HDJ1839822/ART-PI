# 以ART-PI(STM32H750XB)为例扩展  裸机高移植性框架与应用系列



### 第一小节（使用CubeMX配置CPU时钟以及时钟基准,开启板载LED的IO,编写基本框架）



- ## 使用CubeMX生成基础代码

- ## 了解扩展框架特性

- ## 编写框架

- ## 代码测试

  

  

  

  ### 使用CubeMX生成基础代码

  1. ##### 选择时钟源为外部晶振

  ![image-20230529185130950](C:\Users\何德江\AppData\Roaming\Typora\typora-user-images\image-20230529185130950.png)

  

  2. 配置时钟，使用外部晶振25M  锁相环倍频输出，系统时钟以及各外设时钟开到最大~

  ![image-20230529184648917](C:\Users\何德江\AppData\Roaming\Typora\typora-user-images\image-20230529184648917.png)

  

  3. 配置GPIO(PC15    PI8  低电平点亮，默认拉高不亮)

     ![image-20230529185853987](C:\Users\何德江\AppData\Roaming\Typora\typora-user-images\image-20230529185853987.png)

     4. 生成代码

        ![image-20230529190723541](C:\Users\何德江\AppData\Roaming\Typora\typora-user-images\image-20230529190723541.png)

     

![image-20230529190637224](C:\Users\何德江\AppData\Roaming\Typora\typora-user-images\image-20230529190637224.png)





### 了解扩展框架特性：

首先了解 我们一般最常见的开发中，开发的分层一般是在应用层里面直接去调用驱动层，酱紫编写是最简单的，不过在项目中进行产品的迭代会换成其他的MCU以降低成本，这样我们就要重写应用代码以及驱动代码，熟悉该项目的可能比较快，但是时间久了以后不熟悉该项目，或者项目换人了，要重写全部代码是一件脑壳疼的事情，于是就延伸出了这么一套框架，可以直接更改驱动层代码（驱动层代码都有功能性函数，坑挖好了，直接填）而不用去再实现应用层    如下：



1. 编写设备描述层~(抽象出设备可能有哪些需要的功能)，如下图抽象出了_LED_Device这么一个设备结构体（该结构体位于“LED_Device_struct.h"）

   有以下功能：

   GPIO_Init     Turn_on    Turn_off     看到这几个功能是初始化，打开LED，关闭LED   也就是说，我们对于要实现模块的哪些功能先做一个大致的规划

   还可以扩展，如果我要实现呼吸灯，那么可以用到定时器，就可以抽象出 Set_led_brightness这么一个功能，用到定时器，可以把定时器单独抽象出一个结构体，这里调用定时器抽象出的结构体，有没有继承那感觉, 还可以实现LED的开关时间对吧，可以想想到的比较多，以后会慢慢对该系列的扩展，提高其健壮性

   

![image-20230529192311014](C:\Users\何德江\AppData\Roaming\Typora\typora-user-images\image-20230529192311014.png)

2. 对该结构体进行初始化 （该结构体位于“LED_Device_struct.c"）

   如下可以看到使用了结构体数组对  LED_Device也就是_LED_Device结构体进行初始化（抽象_LED_Device使用了Typedef）

   可以看到实现了两个设备，一个是LED_R和LED_B，提供初始化函数和开关函数，这里的两个LED都是同一种函数（这里仅是测试）

   当然可以编写不同LED的初始化函数以及功能（不同函数名）或者编写相同函数但要对设备进行选择，对于不是太多的设备，更倾向于前一种，对于多个设备，更加倾向于后一种。

   

   ![image-20230529194259060](C:\Users\何德江\AppData\Roaming\Typora\typora-user-images\image-20230529194259060.png)

3.如上两个步骤并未实现功能性函数，我们再添加功能性函数，考虑如果现在直接在初始化以及开关这些函数中调用驱动层函数会怎么样？这对于以后的扩展并不友好，我们再抽象出一个标准API层，调用其不变的函数，就不会影响我们对设备的初始化

